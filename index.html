<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description"
        content="A Christ-centered community of young adults at Calhoun SDA Church. Because purpose isn't accidental." />
    <title>On Purpose | Calhoun YA</title>

    <!-- Favicon -->
    <link rel="icon" href="onPurposeColorBGIcon.svg" type="image/svg+xml">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,700;1,9..144,400&family=Inter:wght@300;400;500;600&display=swap"
        rel="stylesheet">

    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            forest: '#2d3b2d',    // Deep, soft green
                            sage: '#8fa89f',      // Quiet accent green
                            clay: '#d6825c',      // Warm terracotta
                            sand: '#e8e2d6',      // Soft tan for borders
                            cream: '#fbf9f4',     // Warm off-white
                            ink: '#1c1c1c'        // Soft black
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Fraunces', 'serif']
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #fbf9f4;
            color: #1c1c1c;
            overflow-x: hidden;
            font-family: 'Inter', sans-serif;
        }

        /* Subtle Paper Texture Overlay */
        .paper-grain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            opacity: 0.05;
        }

        .text-balance {
            text-wrap: balance;
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #fbf9f4;
        }

        ::-webkit-scrollbar-thumb {
            background: #d6825c;
            border-radius: 10px;
            border: 2px solid #fbf9f4;
        }
    </style>
</head>

<body class="antialiased selection:bg-brand-clay selection:text-white">
    <div class="paper-grain"></div>

    <!-- Navigation -->
    <nav id="navbar"
        class="fixed w-full z-50 transition-all duration-500 py-6 px-6 lg:px-12 flex justify-between items-center">
        <a href="#" class="font-serif font-bold text-2xl tracking-tight italic group">
            On<span class="text-brand-clay group-hover:text-brand-forest transition-colors font-serif">Purpose</span>
        </a>

        <div
            class="hidden md:flex items-center space-x-12 text-[11px] font-bold uppercase tracking-[0.2em] text-brand-forest/70">
            <a href="#about" class="hover:text-brand-clay transition-colors">About</a>
            <a href="#events" class="hover:text-brand-clay transition-colors">Events</a>
            <a href="#journal" class="hover:text-brand-clay transition-colors">Gallery</a>
        </div>

        <button class="md:hidden p-2 text-brand-forest"
            onclick="document.getElementById('mobile-menu').classList.toggle('hidden')">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 8h16M4 16h16"></path>
            </svg>
        </button>
    </nav>

    <!-- Mobile Menu -->
    <div id="mobile-menu"
        class="hidden fixed inset-0 z-[60] bg-brand-cream flex flex-col items-center justify-center gap-10 text-center">
        <div class="flex flex-col gap-6 text-3xl font-serif italic font-bold text-brand-forest">
            <a href="#about" onclick="document.getElementById('mobile-menu').classList.add('hidden')">About</a>
            <a href="#events" onclick="document.getElementById('mobile-menu').classList.add('hidden')">Events</a>
            <a href="#journal" onclick="document.getElementById('mobile-menu').classList.add('hidden')">Gallery</a>
        </div>
        <button onclick="document.getElementById('mobile-menu').classList.add('hidden')"
            class="text-xs uppercase tracking-widest opacity-40 font-bold">Close Menu</button>
    </div>

    <!-- Hero Section -->
    <header class="relative min-h-[90vh] flex flex-col justify-center max-w-7xl mx-auto px-6 pt-20 pb-32">
        <div class="max-w-4xl mx-auto text-center gsap-hero-content">
            <div class="flex items-center justify-center gap-3 mb-8">
                <span class="h-[1px] w-10 bg-brand-clay"></span>
                <span class="text-brand-clay font-bold uppercase tracking-[0.4em] text-[10px]">Calhoun YA</span>
                <span class="h-[1px] w-10 bg-brand-clay"></span>
            </div>
            <h1 class="font-serif text-6xl md:text-8xl lg:text-9xl leading-[1.05] mb-10 text-balance tracking-tight">
                Purpose isn't <br><em class="italic font-serif text-brand-clay">accidental.</em>
            </h1>
            <p class="text-lg md:text-2xl text-brand-forest/70 max-w-2xl mx-auto font-light leading-relaxed mb-20">
                A Christ-centered community of young adults in Calhoun, GA. Doing life together, growing in faith, and
                serving our city.
            </p>
            <div class="flex flex-wrap gap-8 justify-center">
                <a href="#events"
                    class="bg-brand-clay text-white px-12 py-5 rounded-xl text-xs font-bold uppercase tracking-widest shadow-xl shadow-brand-clay/20 hover:scale-105 transition-transform">
                    See What's Happening
                </a>
                <a href="#about"
                    class="inline-flex items-center gap-4 text-xs font-bold uppercase tracking-widest group">
                    New Here?
                    <span class="w-12 h-[1px] bg-brand-clay group-hover:w-20 transition-all duration-500"></span>
                </a>
            </div>
        </div>

        <div
            class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-brand-clay/5 rounded-full blur-[120px] -z-10">
        </div>
    </header>

    <!-- About Section -->
    <section id="about"
        class="py-32 bg-brand-forest text-brand-cream rounded-t-[3rem] lg:rounded-t-[5rem] relative z-10 shadow-2xl">
        <div class="max-w-5xl mx-auto px-6 text-center">
            <span class="text-brand-clay font-bold tracking-[0.4em] text-[10px] uppercase mb-8 block">Our
                Foundation</span>

            <blockquote class="font-serif text-2xl md:text-5xl text-brand-cream leading-tight italic mb-12 gsap-fade">
                <span id="verseDisplay">Loading verse...</span>
            </blockquote>

            <div class="h-[1px] w-24 bg-brand-clay/40 mx-auto mb-20"></div>

            <div class="grid md:grid-cols-3 gap-16 text-left gsap-fade">
                <div class="group">
                    <span class="font-serif italic text-brand-clay text-3xl mb-4 block">1.</span>
                    <h3 class="font-serif font-bold text-2xl mb-4 italic tracking-tight">Connect</h3>
                    <p class="text-sm text-brand-cream/50 leading-relaxed font-light">Building genuine friendships that
                        go beyond Sabbath morning. We do lunch, hikes, game nights, and life together.</p>
                </div>
                <div class="group">
                    <span class="font-serif italic text-brand-sage text-3xl mb-4 block">2.</span>
                    <h3 class="font-serif font-bold text-2xl mb-4 italic tracking-tight">Grow</h3>
                    <p class="text-sm text-brand-cream/50 leading-relaxed font-light">Deep diving into Scripture without
                        the fluff. Join our Sabbath School class every week at 10:00 AM.</p>
                </div>
                <div class="group">
                    <span class="font-serif italic text-brand-sand text-3xl mb-4 block">3.</span>
                    <h3 class="font-serif font-bold text-2xl mb-4 italic tracking-tight">Serve</h3>
                    <p class="text-sm text-brand-cream/50 leading-relaxed font-light">Putting faith into action. We get
                        involved in local initiatives and church projects to love our neighbors.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Events Section -->
    <section id="events" class="max-w-6xl mx-auto px-6 pt-32 pb-8">
        <div class="flex flex-col md:flex-row justify-between items-end mb-20 gap-8">
            <div>
                <span class="text-brand-clay font-bold uppercase tracking-[0.4em] text-[10px]">What's Happening</span>
                <h2 class="font-serif text-5xl md:text-6xl mt-4 italic">Upcoming Events.</h2>
            </div>
            <div id="countdown" class="text-[11px] uppercase tracking-widest text-brand-forest/40 font-bold mb-2"></div>
        </div>

        <div id="event-list" class="grid grid-cols-1 gap-6">
            <div class="py-20 text-center italic font-serif opacity-30">Fetching calendar...</div>
        </div>

        <!-- Weekly Static Card -->
        <div
            class="mt-12 p-8 md:p-12 bg-brand-sand/20 border border-brand-sand rounded-[2rem] flex flex-col md:flex-row items-center gap-10">
            <div class="flex-1 text-center md:text-left">
                <div class="flex items-center gap-2 mb-4 justify-center md:justify-start">
                    <span class="w-2 h-2 bg-brand-clay rounded-full animate-pulse"></span>
                    <span class="text-brand-forest/60 text-[10px] font-bold uppercase tracking-widest">Every Week</span>
                </div>
                <h3 class="font-serif text-3xl mb-4 italic tracking-tight text-brand-forest">Sabbath School</h3>
                <p class="text-brand-forest/60 text-sm leading-relaxed max-w-md">Join us every Saturday at 10:00 AM for
                    deep discussion and fellowship at God's Pantry (Right Side Entrance).</p>
            </div>
            <a href="https://maps.google.com/?q=1411+Rome+Rd+SW,+Calhoun,+GA+30701" target="_blank"
                class="bg-brand-forest text-white px-8 py-4 rounded-xl text-[10px] font-bold uppercase tracking-widest hover:bg-brand-clay transition-all shadow-xl shadow-brand-forest/10 whitespace-nowrap">
                üìç God's Pantry
            </a>
        </div>
    </section>

    <!-- Gallery Section -->
    <!-- Instagram Section (Restored) -->
    <section id="journal" class="py-24 px-4 bg-brand-cream">
        <div class="max-w-6xl mx-auto">
            <div class="text-center mb-12">
                <h2 class="font-serif text-4xl font-bold text-brand-forest">Life On Purpose</h2>
                <a href="https://instagram.com/onpurpose.ya" target="_blank"
                    class="inline-block mt-2 text-brand-clay font-medium hover:underline">@onpurpose.ya</a>
            </div>

            <!-- Grid -->
            <div id="instagramGrid" class="grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6"></div>
        </div>
    </section>

    <!-- Footer -->
    <!-- Footer (Restored) -->
    <footer class="bg-brand-forest text-white pt-16 pb-8 px-6 border-t border-white/10">
        <div class="max-w-4xl mx-auto text-center">
            <img src="onPurposeWhite.svg" onerror="this.style.display='none'" class="h-16 mx-auto mb-6 opacity-90"
                alt="Logo">

            <p class="text-brand-sage font-light mb-8">
                A ministry of the Calhoun Seventh-day Adventist Church.
            </p>

            <div class="flex flex-wrap justify-center gap-6 text-sm font-medium tracking-wide mb-12">
                <a href="#about" class="hover:text-brand-clay transition">About</a>
                <a href="#events" class="hover:text-brand-clay transition">Events</a>
                <a href="mailto:info@onpurposeya.com" class="hover:text-brand-clay transition">Contact</a>
                <a href="https://adventistgiving.org/donate/ANTFEG" class="hover:text-brand-clay transition">Donate</a>
            </div>

            <div
                class="border-t border-white/10 pt-8 flex flex-col md:flex-row justify-between items-center text-xs text-brand-cream/60 gap-4">
                <p>&copy; <span id="year"></span> On Purpose YA.</p>
                <p>Designed for the Kingdom.</p>
            </div>
        </div>
    </footer>

    <script>
        const API_EVENTS = 'https://onpurpose-events.jdawg2450.workers.dev/';
        const API_INSTA = 'https://onpurpose-insta.jdawg2450.workers.dev/';

        document.getElementById("year").textContent = new Date().getFullYear();

        const verseText = "\u201cAnd we know that in all things God works for the good of those who love him, who have been called according to his purpose.\u201d";
        const verseRef = "Romans 8:28";
        document.getElementById("verseDisplay").innerHTML = `${verseText} <br><span class="block text-sm font-sans font-bold not-italic mt-6 text-brand-clay uppercase tracking-[0.3em]">- ${verseRef}</span>`;

        window.toggleDescription = function (id) {
            const textEl = document.getElementById(id);
            const btnEl = document.getElementById('btn-' + id);
            if (!textEl) return;

            if (textEl.classList.contains('line-clamp-2')) {
                textEl.classList.remove('line-clamp-2');
                if (btnEl) btnEl.textContent = 'Show Less';
            } else {
                textEl.classList.add('line-clamp-2');
                if (btnEl) btnEl.textContent = 'Read More';
            }
        };

        window.addEventListener("DOMContentLoaded", () => {
            gsap.registerPlugin(ScrollTrigger);

            gsap.from(".gsap-hero-content", {
                opacity: 0,
                y: 40,
                duration: 1.5,
                ease: "power3.out",
                delay: 0.2
            });

            gsap.utils.toArray('.gsap-fade').forEach(el => {
                gsap.from(el, {
                    opacity: 0,
                    y: 30,
                    duration: 1.2,
                    scrollTrigger: { trigger: el, start: "top 90%" }
                });
            });

            window.addEventListener('scroll', () => {
                const nav = document.getElementById('navbar');
                if (window.scrollY > 50) {
                    nav.classList.add('bg-brand-cream/90', 'backdrop-blur-md', 'py-4', 'shadow-sm');
                    nav.classList.remove('py-6');
                } else {
                    nav.classList.remove('bg-brand-cream/90', 'backdrop-blur-md', 'py-4', 'shadow-sm');
                    nav.classList.add('py-6');
                }
            });

            loadEvents();
            loadInstagram();
        });

        function escapeHTML(str) {
            return String(str).replace(/[&<>"']/g, c => ({
                '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
            }[c]));
        }

        function findFirstUrlAndClean(text) {
            if (!text) return { link: null, cleaned: '' };
            const div = document.createElement('div');
            div.innerHTML = text;
            let link = div.querySelector('a[href]')?.getAttribute('href') || null;
            let plain = div.textContent || div.innerText || "";
            const urlRe = /(?:(?:https?:\/\/)|(?:www\.)|(?:[a-zA-Z0-9-]+\.(?:com|org|net|edu|gov|io)))[^\s]*/gi;
            if (!link) {
                const matches = plain.match(urlRe);
                if (matches && matches.length > 0) {
                    link = matches[0].startsWith('http') ? matches[0] : 'https://' + matches[0];
                }
            }
            const cleaned = plain.replace(urlRe, '').trim();
            return { link, cleaned };
        }

        async function loadEvents() {
            const container = document.getElementById('event-list');
            try {
                const res = await fetch(API_EVENTS);
                const data = await res.json();
                const now = new Date();
                now.setHours(0, 0, 0, 0);

                const events = (data.items || [])
                    .map(e => ({ ...e, startObj: e.start.dateTime ? new Date(e.start.dateTime) : new Date(e.start.date + 'T00:00:00') }))
                    .filter(e => e.startObj >= now)
                    .sort((a, b) => a.startObj - b.startObj)
                    .slice(0, 4);

                container.innerHTML = '';
                if (events.length > 0) {
                    const first = events[0];
                    const diff = first.startObj - new Date();
                    const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
                    document.getElementById('countdown').textContent = `Next Event in ${d} days, ${h} hours`;
                }

                events.forEach((event, idx) => {
                    const date = event.startObj;
                    const { link, cleaned } = findFirstUrlAndClean(event.description || '');
                    const finalLink = link || event.htmlLink;
                    const descId = `desc-${idx}`;
                    const needsReadMore = cleaned && cleaned.length > 120;

                    // CHECK FOR RSVP LINK
                    const isForm = finalLink && (finalLink.includes('forms.gle') || finalLink.includes('docs.google.com/forms') || finalLink.includes('tally.so'));

                    let location = event.location || '';
                    if (location) {
                        location = location
                            .replace(/,?\s*(?:USA|United States|US)\b/gi, '')
                            .replace(/,?\s*\b\d{5}(?:-\d{4})?\b/g, '')
                            .trim()
                            .replace(/,$/, '');
                    }

                    const html = `
            <div class="bg-white border border-brand-sand rounded-[1.5rem] p-6 md:p-8 flex flex-col md:flex-row items-center gap-8 group hover:shadow-xl transition-all duration-500">
                <div class="flex flex-col items-center justify-center w-20 h-20 bg-brand-forest text-brand-cream rounded-2xl shrink-0">
                  <span class="text-[10px] uppercase font-bold tracking-tighter">${date.toLocaleDateString('en-US', { month: 'short' })}</span>
                  <span class="font-serif text-2xl font-bold italic">${date.getDate()}</span>
                </div>
                
                <div class="flex-1 text-center md:text-left">
                  <h3 class="font-serif text-2xl md:text-3xl tracking-tight text-brand-forest group-hover:text-brand-clay transition-colors duration-500 cursor-pointer" onclick="toggleDescription('${descId}')">
                    ${escapeHTML(event.summary)}
                  </h3>
                  <div class="flex flex-wrap justify-center md:justify-start gap-4 text-[10px] font-bold uppercase tracking-widest text-brand-forest/40 mt-2 mb-3">
                    <span>${event.start.dateTime ? date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }) : 'All Day'}</span>
                    <span>‚Ä¢</span>
                    <span>${escapeHTML(location || 'Calhoun, GA')}</span>
                  </div>
                  
                  ${cleaned ? `
                    <p id="${descId}" class="text-brand-forest/60 text-sm leading-relaxed line-clamp-2 transition-all duration-500">
                      ${escapeHTML(cleaned)}
                    </p>
                    ${needsReadMore ? `
                      <button id="btn-${descId}" onclick="toggleDescription('${descId}')" class="text-brand-clay text-[10px] font-bold uppercase tracking-widest mt-2 hover:text-brand-forest transition-colors">
                        Read More
                      </button>
                    ` : ''}
                  ` : ''}
                </div>

                <div class="shrink-0">
                  ${isForm ? `
                    <a href="${finalLink}" target="_blank" class="flex items-center justify-center px-6 py-3 rounded-xl bg-brand-clay text-white text-[10px] font-bold uppercase tracking-widest hover:bg-brand-forest transition-all shadow-md">
                        RSVP
                    </a>
                  ` : `
                    <a href="${finalLink}" target="_blank" class="flex items-center justify-center w-12 h-12 rounded-full border border-brand-sand hover:bg-brand-clay hover:border-brand-clay hover:text-white transition-all">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                    </a>
                  `}
                </div>
            </div>
          `;
                    container.insertAdjacentHTML('beforeend', html);
                });
            } catch (e) {
                container.innerHTML = '<div class="py-12 text-center opacity-30 italic font-serif">Updating calendar...</div>';
            }
        }

        async function loadInstagram() {
            const container = document.getElementById('instagramGrid');
            try {
                const res = await fetch(API_INSTA);
                const data = await res.json();
                if (data.error || !data.data) {
                    container.innerHTML = '<p class="col-span-full text-center text-gray-400 text-sm">Follow us @onpurpose.ya</p>';
                    return;
                }
                container.innerHTML = '';
                data.data.slice(0, 4).forEach(post => {
                    let imgUrl = post.media_url;
                    if (post.media_type === 'VIDEO' || post.media_type === 'CAROUSEL_ALBUM') {
                        imgUrl = post.thumbnail_url || post.media_url;
                    }
                    const typeEmoji = post.media_type === 'VIDEO' ? '‚ñ∂Ô∏è' : (post.media_type === 'CAROUSEL_ALBUM' ? '‚ú®' : 'üì∏');
                    const caption = post.caption || 'View Post';
                    const item = `
             <a href="${post.permalink}" target="_blank" class="group block relative aspect-square overflow-hidden rounded-xl bg-gray-100 shadow-md hover:shadow-xl transition-all duration-300">
               <img src="${imgUrl}" class="w-full h-full object-cover transition duration-700 group-hover:scale-110" alt="Instagram Post">
               <div class="absolute inset-0 bg-brand-forest/80 backdrop-blur-[2px] opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col items-center justify-center p-6 text-center">
                  <div class="text-3xl mb-3 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300 delay-75">${typeEmoji}</div>
                  <p class="text-white text-sm font-medium line-clamp-4 mb-4 transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300 delay-100 leading-relaxed">${escapeHTML(caption)}</p>
                  <span class="text-brand-clay text-xs font-bold uppercase tracking-widest transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300 delay-150">View on Instagram</span>
               </div>
             </a>
           `;
                    container.insertAdjacentHTML('beforeend', item);
                });
            } catch (err) { console.error(err); }
        }
    </script>
</body>

</html>
